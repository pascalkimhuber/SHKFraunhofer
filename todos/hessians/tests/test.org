* Tests of the Lennard-Jones Hessian implementation in tremolo <2015-01-21 Wed>

** Overview: Lennard-Jones potential
Set
\begin{equation}
  \label{eq:1}
  V(r) =  4 \varepsilon \left( (\frac{\sigma}{r})^{12} -
    (\frac{\sigma}{r})^{6} \right) = 4 \varepsilon \left( R^{12} -
    R^6 \right),  \qquad \text{ with } R = \frac{\sigma}{r},
\end{equation}
and
\begin{equation}
  \label{eq:2}
  r(\boldp, \boldq) = \lVert \boldq - \boldp \rVert =
  \sqrt{\sum_{i=1}^d r_i^2} \qquad \text{ with } r_i \coloneqq (q_i - p_i).
\end{equation}

*** Partial derivatives of r
We have (\(r = r(\boldp, \boldq)\)):
\begin{align}
\partial_{p_i} r(\boldp, \boldq) &= - \frac{r_i}{r},  \\
\partial_{q_j} r(\boldp, \boldq) &=  \frac{r_j}{r},  \\
\partial_{q_i}\partial_{p_i} r(\boldp, \boldq) &= - \partial_{p_i}\partial_{p_i} r(\boldp, \boldq) =  \frac{r_i^2}{r^3} - \frac{1}{r},  \\
\partial_{q_j}\partial_{p_i} r(\boldp, \boldq) &= - \partial_{p_j}\partial_{p_i} r(\boldp, \boldq) =  \frac{r_ir_j}{r^3}, \\
\end{align}

*** Derivatives of the Lennard-Jones potential
We have
\begin{align}
  V'(r) &= \frac{24 \varepsilon}{r} R^6 \left(1 - 2 R^6\right) \\
  V''(r) &= \frac{24 \varepsilon}{r^2} R^6 \left( 26 R^6 - 7 \right).
\end{align}

*** Lennard-Jones forces and Hessians
We have
\begin{align}
  \partial_{p_i} V(r(\boldp, \boldq)) &= - \frac{24 \varepsilon}{r^2} R^6 \left(1 - 2 R^6\right)r_i \\
  \partial_{q_i}\partial_{p_i} V(r(\boldp, \boldq)) &= - \partial_{p_i}\partial_{p_i} V(r(\boldp, \boldq)) = \frac{24 \varepsilon}{r^4} R^6 \left(8 - 28 R^6\right)r_i^2 - \frac{24 \varepsilon}{r^2} R^6 \left(1 - 2 R^6\right) \\
  \partial_{q_j}\partial_{p_i} V(r(\boldp, \boldq)) &= - \partial_{p_j}\partial_{p_i} V(r(\boldp, \boldq)) = \frac{24 \varepsilon}{r^4} R^6 \left(8 - 28 R^6\right)r_ir_j
\end{align}

** Test parameters
Summary of the test parameters. The directory to the parameter files for tremolo can be found [[file:~/Sandbox/testHessians/][here]].
- sigma = epsilon = 1
- cellrcut = 12
- edge length of the cube: 80
- delta_T = 5.0e-3
- endtime = 5.0e-1
- outvis T_Delta = 1.0e-2
The test distances at which the particles are initially situated are given by:
- r_1 = 1 sigma
- r_2 = r_m = 2^(1/6) sigma
- r_3 = 3/2 sigma
- r_4 = 4 sigma
- r_5 = 20 (zero interaction)

** Without hessian tag
If the tag <hessians> does not exist, no files =<projectname>.xxxx.hessians= are created.
If the tag <hessians> exists but the option =measure=off= is set, no files =<projectname>.xxxx.hessians= are created.
If the tag <hessians> exists and an invalid option is set, then tremolo displays an error message and aborts the simulation.

** Test for two particles
Note that the local Hessians for a single particle \partial_{pp} and for two different particles \partial_{pq} only differ by a sign.
*** Particles aligned in x-direction, no start velocities
For two particles aligned in x-direction one expects:
- diagonal matrices for all local Hessians (since all entries of the form r_i r_j should vanish if i \neq j)
- the second and third diagonal entry should be equal
**** Summary
As expected one obtains for all radii diagonal matrices for which the second and third diagonal entries are equal.
For r_2 only the first entry is no equal to zero which is expected since the other two diagonal entries are given by the force value which in this case is zero as the particles are already at the energy minimum.
For r_5 no entries are calculated since the distance between the particles is larger than r_cut.
**** r_1
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0	40.0    40.0	0.0	0.0	0.0	Argon
2	41.0	40.0	40.0	0.0	0.0	0.0	Argon
#+END_SRC
At all time steps one obtains diagonal matrices as expected.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1, diag(456, 24, 24)
- 0050 :: r = 1.8156, diag(1.275256, 0.191907, 0.191907)
- 0100 :: r = 2.16214, diag(0.338966, 0.049267, 0.049267)
**** r_2
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0          40.0    40.0	0.0	0.0	0.0	Argon
2	41.122462048  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
Since r_2 is the distance of the minimal potential energy the distance between the two particles remains the same during the whole simulation.
As expected one obtains at all times the same matrix which consists of only one single non-zero entry at the (1,1)-position.
The other two diagonal entries dissapear since they consists basically of the force between the two particles which vanishes in this case.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1.122462048, diag(57.146438, 0, 0)
- 0050 :: r = 1.122462048, diag(57.146438, 0, 0)
- 0100 :: r = 1.122462048, diag(57.146438, 0, 0)
**** r_3
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	41.5  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
As for r_1 one obtains at all time steps diagonal matrices.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1.5, diag(4.41759, 0.772019, 0.772019)
- 0050 :: r = 1,13286, diag(46.886467, 0.476441, 0.476441)
- 0100 :: r = 1.45254, diag(5.125041, 0.953188, 0.953188)
**** r_4
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	44.0  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
Same situation as for r_3.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 4, diag(0.002561, 0.000366, 0.000366)
- 0050 :: r = 3.99926, diag(0.002565, 0.000367, 0.000367)
- 0100 :: r = 3.99706, diag(0.002576, 0.000368, 0.000368)
**** r_5
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	60.0  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case no interaction between the two particles can happen, since the distance larger than r_cut. Thus at all times one gets empty hessians file of the following form:
#+BEGIN_SRC sh
# time 0.000000e+00
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
Note that in the case of r = r_cut Hessians are calculated and one does not obtain empty hessians files but files which contain all only zero matrices!
*** Particles aligned in y-direction, no start velocities
For two particles aligned in y-direction one expects:
- diagonal matrices for all local Hessians (since all entries of the form r_i r_j should vanish if i \neq j)
- the first and third diagonal entry should be equal
**** Summary
One obtains the analogous results as for the case of x-aligned particles.
**** r_1
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0	40.0    40.0	0.0	0.0	0.0	Argon
2	40.0	41.0	40.0	0.0	0.0	0.0	Argon
#+END_SRC
At all time steps one obtains diagonal matrices as expected.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1, diag(24, 456, 24)
- 0050 :: r = 1.8156, diag(0.191907, 1.275256, 0.191907)
- 0100 :: r = 2.16214, diag(0.049267, 0.338966, 0.049267)
**** r_2
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0    40.0          40.0	0.0	0.0	0.0	Argon
2	40.0    41.122462048  40.0	0.0	0.0	0.0	Argon
#+END_SRC
Since r_2 is the distance of the minimal potential energy the distance between the two particles remains the same during the whole simulation.
As expected one obtains at all times the same matrix which consists of only one single non-zero entry at the (2,2)-position.
The other two diagonal entries dissapear since they consists basically of the force between the two particles which vanishes in this case.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1.122462048, diag(0, 57.146438, 0)
- 0050 :: r = 1.122462048, diag(0, 57.146438, 0)
- 0100 :: r = 1.122462048, diag(0, 57.146438, 0)
**** r_3
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  41.5    40.0	0.0	0.0	0.0	Argon
#+END_SRC
As for r_1 one obtains at all time steps diagonal matrices.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1.5, diag(0.772019, 4.41759, 0.772019)
- 0050 :: r = 1,13286, diag(0.476441, 46.886467, 0.476441)
- 0100 :: r = 1.45254, diag(0.953188, 5.125041, 0.953188)
**** r_4
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  44.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
Same situation as for r_3.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 4, diag(0.000366, 0.002561, 0.000366)
- 0050 :: r = 3.99926, diag(0.000367, 0.002565, 0.000367)
- 0100 :: r = 3.99706, diag(0.000368, 0.002576, 0.000368)
**** r_5
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  60.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case no interaction between the two particles can happen, since the distance larger than r_cut. Thus at all times one gets empty hessians file of the following form:
#+BEGIN_SRC sh
# time 0.000000e+00
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
Note that in the case of r = r_cut Hessians are calculated and one does not obtain empty hessians files but files which contain all only zero matrices!
*** Particles aligned in z-direction, no start velocities
For two particles aligned in z-direction one expects:
- diagonal matrices for all local Hessians (since all entries of the form r_i r_j should vanish if i \neq j)
- the first and second diagonal entry should be equal
**** Summary
One obtains the analogous results as for the case of x-aligned and y-aligned particles.
**** r_1
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0	40.0    40.0	0.0	0.0	0.0	Argon
2	40.0	40.0	41.0	0.0	0.0	0.0	Argon
#+END_SRC
At all time steps one obtains diagonal matrices as expected.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1, diag(24, 24, 456)
- 0050 :: r = 1.8156, diag(0.191907, 0.191907,  1.275256)
- 0100 :: r = 2.16214, diag(0.049267, 0.049267, 0.338966)
**** r_2
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0    40.0    40.0           0.0	0.0	0.0	Argon
2	40.0    40.0	41.122462048   0.0	0.0	0.0	Argon
#+END_SRC
Since r_2 is the distance of the minimal potential energy the distance between the two particles remains the same during the whole simulation.
As expected one obtains at all times the same matrix which consists of only one single non-zero entry at the (3,3)-position.
The other two diagonal entries dissapear since they consists basically of the force between the two particles which vanishes in this case.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1.122462048, diag(0, 0, 57.146438)
- 0050 :: r = 1.122462048, diag(0, 0, 57.146438)
- 0100 :: r = 1.122462048, diag(0, 0, 57.146438)
**** r_3
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  40.0    41.5	0.0	0.0	0.0	Argon
#+END_SRC
As for r_1 one obtains at all time steps diagonal matrices.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 1.5, diag(0.772019, 0.772019, 4.41759)
- 0050 :: r = 1,13286, diag(0.476441, 0.476441, 46.886467)
- 0100 :: r = 1.45254, diag(0.953188, 0.953188, 5.125041)
**** r_4
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  40.0    44.0	0.0	0.0	0.0	Argon
#+END_SRC
Same situation as for r_3.
In the following the absolute values of the local Hessian \partial_{p_1 p_1} are given:
- 0000 :: r = 4, diag(0.000366, 0.000366, 0.002561)
- 0050 :: r = 3.99926, diag(0.000367, 0.000367, 0.002565)
- 0100 :: r = 3.99706, diag(0.000368, 0.000368, 0.002576)
**** r_5
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  40.0    60.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case no interaction between the two particles can happen, since the distance larger than r_cut. Thus at all times one gets empty hessians file of the following form:
#+BEGIN_SRC sh
# time 0.000000e+00
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
Note that in the case of r = r_cut Hessians are calculated and one does not obtain empty hessians files but files which contain all only zero matrices!
*** Particles aligned along a diagonal, no start velocities
For two (initially stationary) particles which are aligned along a space diagonal one can expect:
- all diagonal entries of the local Hessians are equal
- all non-diagonal entries of the local Hessians are equal
**** Summary
As expected all computed local Hessians have the mentioned symmetric properties, such that all diagonal entries on the one hand and all non-diagonal entries on the other hand are equal.
In contrast to the previous cases no entries are equal to zero which is also quite reasonable, since the difference vector has no zero-entries.
The values of the entries seem to be correct as well.
**** r_1
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	40.577350269    40.577350269    40.577350269	0.0	0.0	0.0	Argon
#+END_SRC
The local Hessian \partial_{p_1 p_1} for the first particle at time 0 is given by\\
[136.000001 160.000001 160.000001]\\
[160.000001 136.000001 160.000001]\\
[136.000001 160.000001 136.000001]
The other three local Hessians differ only in the sign. As expected all diagonal entries are equal as are the non-diagonal ones.
The difference between the diagonal and non-diagonal entries is 24 which is exactly the norm of the force between the particles.
In the following the local Hessians \partial_{p_1 p_1} are given
- 0000 :: r = 1, (136.000001 160.000001 160.000001, 160.000001 136.000001 160.000001, 136.000001 160.000001 136.000001)
- 0050 :: r = 1.815587618, (-0.297147 -0.489054 -0.489054, -0.489054 -0.297147 -0.489054, -0.489054 -0.489054 -0.297147)
- 0100 :: r = 2.162136344, (-0.080144 -0.129411 -0.129411, -0.129411 -0.080144 -0.129411, -0.129411 -0.129411 -0.080144)
**** r_2
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	40.648053766    40.648053766    40.648053766	0.0	0.0	0.0	Argon
#+END_SRC
The local Hessian \partial_{p_1 p_1} for the first particle at time 0 is given by\\
[19.048812 19.048812 19.048812]\\
[19.048812 19.048812 19.048812]\\
[19.048812 19.048812 19.048812]\\
All entries are equal. Since the force at r_2 vanishes the second summand in the term for the diagonal entries of the
local Hessians dissappears and the remaining term is equal to the formula for the non-diagonal entries of the local Hessians.
In the following the local Hessians \partial_{p_1 p_1} are given
- 0000 :: r = 1.122462048, (19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812)
- 0050 :: r = 1.122462048, (19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812)
- 0100 :: r = 1.122462048, (19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812)
**** r_3
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	40.866025404	40.866025404	40.866025404	0.0	0.0	0.0	Argon
#+END_SRC
The local hessian \partial_{p_1 p_1} for the first particle at time 0 is given by\\
[-0.957852 -1.729871 -1.729871]\\
[-1.729871 -0.957852 -1.729871]\\
[-1.729871 -1.729871 -0.957852]\\
The situation is similar as for r_1, i.e. the diagonal entries and the non-diagonal entries each are equal which is quite expected.
In the following the local Hessians \partial_{p_1 p_1} are given
- 0000 :: r = 1.5, (-0.957852 -1.729871 -1.729871, -1.729871 -0.957852 -1.729871, -1.729871 -1.729871 -0.957852)
- 0050 :: r = 1.132865151, (15.946450 15.470009 15.470009, 15.470009 15.946450 15.470009, 15.470009 15.470009 15.946450)
- 0100 :: r = 1.452549769, (-1.072889 -2.026076 -2.026076, -2.026076 -1.072889 -2.026076, -2.026076 -2.026076 -1.072889)
**** r_4
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	42.309401077	42.309401077	42.309401077	0.0	0.0	0.0	Argon
#+END_SRC
The local hessian \partial_{p_1 p_1} for the first particle at time 0 is given by\\
[-0.000610 -0.000976 -0.000976]\\
[-0.000976 -0.000610 -0.000976]\\
[-0.000976 -0.000976 -0.000610]\\
In this case too, the local Hessians maintain their symmetry properties as in the other cases.
In the following the local Hessians \partial_{p_1 p_1} are given
- 0000 :: r = 4, (-0.000610 -0.000976 -0.000976, -0.000976 -0.000610 -0.000976, -0.000976 -0.000976 -0.000610)
- 0050 :: r = 3.999270674, (-0.000611 -0.000977 -0.000977, -0.000977 -0.000611 -0.000977, -0.000977 -0.000977 -0.000611)
- 0100 :: r = 3.997070969, (-0.000613 -0.000981 -0.000981, -0.000981 -0.000613 -0.000981, -0.000981 -0.000981 -0.000613)
**** r_5
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	51.547005384	51.547005384	51.547005384	0.0	0.0	0.0	Argon
#+END_SRC
As expected no local Hessians are computed since there is no interaction between the two particles as r_5 > r_cut.
Thus all hessians files look like
#+BEGIN_SRC sh
# time 5.000000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
*** Particle fly-by/swing-by
**** Description
Two particles are positioned at zero-interaction distance from each other (p at (40.0, 40.0, 40.0) and q at (20.0, 45.0, 40.0)).
The first particle (p) is stationary while the second one has an initial velocity ((40.0, 0.0, 0.0)) such that it passes the
first particle at a certain distance.
The .data file is given by
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0    40.0    40.0    0.0	0.0	0.0	Argon
2	20.0    45.0    40.0   40.0	0.0	0.0	Argon
#+END_SRC
The simulation can be devided into three phases:
- zero-interaction phase :: (t = 0 until t = 0.22728...) During this time the Particles have a distance which is larger than the r_cut (12).
     No interaction can be expected and therefore empty hessians-files.
- interaction phase :: (For t = 0.22728 until t = 0.77272...) During the second phase the Particles are near enought to each other
     and one can expect non-zero Hessians. Since the z-coordinate of both Particles stays equal during the whole simulation
     four of the nine entries of the local Hessians should be zero, namely the entries (1,3), (3,1), (2,3), (3,2).
     Furthermore one can expect that the entries grow until time t = 0.5 and decrease afterwards.
- zero-interaction phase :: (t = 0.77272 until t = 1.0) For the remaining time the particles have again zero-interaction distance.
     Hence one should obtain empty hessians-files.
**** Test results
As expected the hessians-files test.0000.hessians, ..., test.0023.hessians and test.0078.hessians, ..., test.0100.hessians are empty (zero-interaction).
The remaining files show the expected local Hessians. E.g. for time t = 0.40 (and up to signs also t = 0.60):
#+BEGIN_SRC sh
# time 4.000000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
1	0	1	0	-0.000018
1	0	1	1	0.000033
1	0	1	2	0.000000
1	1	1	0	0.000033
1	1	1	1	-0.000033
1	1	1	2	-0.000000
1	2	1	0	0.000000
1	2	1	1	-0.000000
1	2	1	2	0.000008
#+END_SRC
One can see that the entries (1,3), (2,3), (3,1) and (3,2) are equal to zero. For t = 0.50 one obtains
#+BEGIN_SRC sh
# time 5.000000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
1	0	1	0	0.000061
1	0	1	1	-0.000000
1	0	1	2	-0.000000
1	1	1	0	-0.000000
1	1	1	1	-0.000430
1	1	1	2	-0.000000
1	2	1	0	-0.000000
1	2	1	1	-0.000000
1	2	1	2	0.000061
#+END_SRC
In this case only the diagonal entries are non-zero since the Particles are aligned in y-direction.
*** Particle collision
**** Description
Two particles are positioned at zero-interaction distance from each other (p at (40.0, 40.0, 40.0) and q at (20.0, 40.0, 40.0)).
The first particle (p) is stationary while the second one has an initial velocity ((40.0, 0.0, 0.0)) such that it will collide
with the first particle at time t=0.50.
The .data file is given by
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0    40.0    40.0    0.0	0.0	0.0	Argon
2	20.0    40.0    40.0   40.0	0.0	0.0	Argon
#+END_SRC
This simulation can be devided into three phases:
- zero-interaction phase :: (t = 0 until t = 0.20) During this time the particles have a distance which is larger than the r_cut (12).
     No interaction can be expected and therefore empty hessians-files.
- interaction phase :: (t = 0.20 until t = 0.57) In this phase the abosolute values of the local Hessian entries increase first with time until the collision at approximately t = 0.5.
     Afterwards they decrease since the second particle bounces back while the other one is accelerated in x-direction.
     Since in this simulation the particles stay aligned in x-direction one can expect diagonal matrices for the local Hessians.
- zero-interaction phase :: (t = 0.58 until t = 1.0) For the remaining time the particles have again zero-ineteraction distance.
**** Test results
As expected the files test.0000.hessians, ..., test.0020.hessians and test.0057.hessians, ..., test.0100.hessians are empty.
All other files display diagonal matrices. For t = 0.48 one gets for the first local Hessian:
#+BEGIN_SRC sh
# time 4.800000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
1	0	1	0	13019.502641
1	0	1	1	0.000000
1	0	1	2	0.000000
1	1	1	0	0.000000
1	1	1	1	-935.941320
1	1	1	2	0.000000
1	2	1	0	0.000000
1	2	1	1	0.000000
1	2	1	2	-935.941320
#+END_SRC
** Test for three particles
*** Three particles in an equilateral triangle
**** General description
Three particles are positioned in such a way that they form an equilateral triangle with side length r = r_1, r_2, r_3, r_4 and r_5.
The first two particles p_1 and p_2 are aligned in x-direction. The third particle p_3 differs in x- and y-direction.
The z-direction of all particles is equal:
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0            40.0		40.0	0.0	0.0	0.0	Argon
2	40.0+r          40.0		40.0	0.0	0.0	0.0	Argon
3	40.0+r/2	40.0+sqrt(3)r/2	40.0	0.0	0.0	0.0	Argon
#+END_SRC
[[file:equi_triang_r1.png]]

Only the Lennard-Jones potential is activated during the simulation, i.e. the entire potential is given by:
\[
V(p_1, p_2, p_3) = V_{12}(p_1, p_2) + V_{13}(p_1, p_3) + V_{23}(p_2, p_3),
\]
where V_{ij} denotes the pair-potential between the particles p_i and p_j.
Knowing this, one can deduce the following formulas for the 9 possible local Hessians:
- H_{11} = \partial_1 \partial_1 V_{12} + \partial_1 \partial_1 V_{13}
- H_{22} = \partial_2 \partial_2 V_{12} + \partial_2 \partial_2 V_{23}
- H_{33} = \partial_3 \partial_3 V_{13} + \partial_3 \partial_3 V_{23}
- H_{12} = \partial_1 \partial_2 V_{12}
- H_{21} = \partial_2 \partial_1 V_{12}
- H_{13} = \partial_1 \partial_3 V_{13}
- H_{31} = \partial_3 \partial_1 V_{13}
- H_{23} = \partial_2 \partial_3 V_{23}
- H_{32} = \partial_3 \partial_2 V_{23}
Hence, the mixed local Hessians can be expected to be similar to the 2 particles case whereas the "diagonal" local Hessians are sums of such expressions.
**** General test results
1. For all choices of r = r_1, r_2, r_3, r_4 and r_5 every two of the mixed local Hessians are equal: H_{12} = H_{21}, H_{13} = H_{31} and H_{23} = H_{32}.
   Furthermore as already expected these local Hessians could have been calculated with only two particles, e.g. particle p_3 does not affect the entries of H_{12}.
   Some sample calculation with only two particles at the same positions confirmed this.
   In particular one obtains a diagonal matrix for H_{12} (p_1 and p_2) are aligned in x-direction.
   The matrices H_{13} and H_{23} however are not diagonal matrices but have vanishing (1,3), (3,1), (2,3) and (3,2) entries (since the z-coordinates of all particles are equal).
   One notes that the entries of H_{13} and H_{23} differ only by the sign which can be traced to the symmetry.
2. The local Hessians H_{11}, H_{22}, H_{33} have all vanishing entries at the (1,3), (3,1), (2,3) and (3,2) positions.
   This seems to be reasonable since one can write these Hessians as sums of mixed local Hessians which has only zeros at these positions (already seen in 1.).
   The simulated values of the entries coincide with samples computed manually.
3. The absolute values of all entries of the local Hessians in inversely proportional to the distance between the particles which agrees with the formulas for the Lennard-Jones Hessians.
As an example the local Hessians in the case of r = r_1 are given. All other cases have the same structure but different numeric values.
- H_{11} :: [552, 207.85, 0]
            [207.85, 312, 0]
            [0, 0, -48]
- H_{22} :: [552, -207.85, 0]
            [-207.85, 312, 0]
            [0, 0, -48]
- H_{33} :: [192, 0, 0]
            [0, 672, 0]
            [0, 0, -48]
- H_{12} = H_{21} :: [-456, 0, 0]
     [0, 24, 0]
     [0, 0, 24]
- H_{13} = H_{31} :: [-96, -207.85, 0]
     [-207.85, -336, 0]
     [0, 0, 24]
- H_{23} = H_{32} :: [-96, 207.85, 0]
     [207.85, -336, 0]
     [0, 0, 24]
**** Eigenvalues of the Hessians
As a further check the eigenvalues of the local Hessians are computed. For the above simulation one expects that the three eigenvalues of the "pure" Hessians (H_{ii}) are always the same. The same should apply for the mixed Hessians (H_{ij}).
In the following the eigenvalues of the computed Hessians at t = 0 for r1, r2 and r3 are given:
One can see that the eigenvalues of the matrices do indeed coincide in the described manner.
***** r1
- H_11 :: \lambda = (672, 192, -48)
- H_22 :: \lambda = (672, 192, -48)
- H_33 :: \lambda = (672, 192, -48)
- H_12 :: \lambda = (24, 24, -456)
- H_13 :: \lambda = (24, 24, -456)
- H_23 :: \lambda = (24, 24, -456)
***** r2
- H_11 :: \lambda = (85.719656, 28.573219, 0.0)
- H_22 :: \lambda = (85.719656, 28.573219, 0.0)
- H_33 :: \lambda = (85.719656, 28.573219, 0.0)
- H_12 :: \lambda = (-57.146437, 0.0, 0.0)
- H_13 :: \lambda = (-57.146438, 0.0, 0.0)
- H_23 :: \lambda = (-57.146437, 0.0, 0.0)
***** r_3
- H_11 :: \lambda = (-6.240382, -1.050768, 1.544038)
- H_22 :: \lambda = (-6.240382, -1.050768, 1.544038)
- H_33 :: \lambda = (-6.240382, -1.050768, 1.544038)
- H_12 :: \lambda = (4.417594, -0.772019, -0.772019)
- H_13 :: \lambda = (4.417594, -0.772019, -0.772019)
- H_23 :: \lambda = (4.417594, -0.772019, -0.772019)
**** r_1
The data file is given by:
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	41.0	40.0		40.0	0.0	0.0	0.0	Argon
3	40.5	40.866025404	40.0	0.0	0.0	0.0	Argon
#+END_SRC
**** r_2
the data file is given by:
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
# ATOMDATA Id x=3 u=3 type
1	40.0		40.0		40.0	0.0	0.0	0.0	Argon
2	41.122462048	40.0		40.0	0.0	0.0	0.0	Argon
3	40.561231024	40.972080649	40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case all particles stay stationary over the whole simulation. The local Hessians are (nearly, up to 6 decimal?) constant.
**** r_3
The data file is given by:
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	41.5	40.0		40.0	0.0	0.0	0.0	Argon
3	40.75	41.299038106	40.0	0.0	0.0	0.0	Argon
#+END_SRC
**** r_4
The data file is given by:
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	44.0	40.0		40.0	0.0	0.0	0.0	Argon
3	42.0	43.464101615	40.0	0.0	0.0	0.0	Argon
#+END_SRC
**** r_5
the data file is given by:
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	60.0	40.0		40.0	0.0	0.0	0.0	Argon
3	50.0	57.320508076	40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case (r > r_cut) all hessians-files are empty for the whole simulation.
*** Particle fly-by
** Test for four particles
*** Four particles in an tetrahedron
**** General description
Four identical particles are positioned in such a way that they form an tetrahedron with side length r = r_1, r_2, r_3, r_4 and r_5, respectively.
The first three particles p_1, p_2 and p_3 form the equilateral triangle described in the section about three particles in an equilateral triangle.
The last particle has a different z-coordinate with respect to the other particles:
#+BEGIN_SRC sh
# ATOMDATA Id x=3 u=3 type
1    40.0       40.0                40.0           0.0    0.0    0.0	Argon
2    40.0+r     40.0                40.0           0.0    0.0    0.0	Argon
3    40.0+r/2	40.0+sqrt(3)r/2     40.0           0.0    0.0    0.0	Argon
4    40.0+r/2   40.0+r/(2*sqrt(3))  40+sqrt(2/3)r  0.0    0.0    0.0    Argon
#+END_SRC
[[file:tetrahedron_r1.png]]
