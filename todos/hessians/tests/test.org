#+TITLE: Test-Log for Hessian implementation in tremolo
#+DATE: \today
#+LATEX_CLASS_OPTIONS: [a4paper]
#+LATEX_HEADER: \usepackage{mathtools}
#+LATEX_HEADER: \usepackage[margin=1in]{geometry}
#+LATEX_HEADER: \newcommand{\boldp}{\boldsymbol{p}}
#+LATEX_HEADER: \newcommand{\boldq}{\boldsymbol{q}}
#+LATEX_HEADER: \newcommand{\reals}{\mathbb{R}}
#+LATEX_HEADER: \makeatletter
#+LATEX_HEADER: \def\verbatim{\scriptsize\@verbatim \frenchspacing\@vobeyspaces \@xverbatim}
#+LATEX_HEADER: \makeatother


* Tests of the Lennard-Jones Hessian implementation in tremolo <2015-01-21 Wed>

** Overview: Lennard-Jones potential
Set
\begin{equation}
  \label{eq:1}
  V(r) =  4 \varepsilon \left( (\frac{\sigma}{r})^{12} -
    (\frac{\sigma}{r})^{6} \right) = 4 \varepsilon \left( R^{12} -
    R^6 \right),  \qquad \text{ with } R = \frac{\sigma}{r},
\end{equation}
and
\begin{equation}
  \label{eq:2}
  r(\boldp, \boldq) = \lVert \boldq - \boldp \rVert =
  \sqrt{\sum_{i=1}^d r_i^2} \qquad \text{ with } r_i \coloneqq (q_i - p_i).
\end{equation}

*** Notation for Hessians
Let \(\boldp_1, \dots, \boldp_N \in \reals^3\) be the coordinates of \(N\) particles and let \(f\) be a function of these coordinates: \(f(\boldp_1, \dots, \boldp_N) = f(\boldp_1^{(1)}, \boldp_1^{(2)}, \boldp_1^{(3)}, \boldp_2^{(1)}, \dots, \boldp_N^{(3)})\in \reals\).
Then we denote by
\begin{align}
D_{\boldp_n}f &= \left((D_{\boldp_n} f)_1, (D_{\boldp_n} f)_2, (D_{\boldp_n} f)_3 \right) \\
              &= \left(\partial_{\boldp_n^{(1)}}f, \partial_{\boldp_n^{(2)}}f, \partial_{\boldp_n^{(3)}}f)\in \reals^3
\end{align}
for all \(n = 1, \dots, N\) the /derivative of \(f\) w.r.t. the particle \(\boldp_n\)/ and by
\begin{align}
D_{\boldp_n} D_{\boldp_m} f =
\begin{pmatrix}
(D_{\boldp_n} D_{\boldp_m}f)_{11} & (D_{\boldp_n} D_{\boldp_m}f)_{12} & (D_{\boldp_n} D_{\boldp_m}f)_{13} \\
(D_{\boldp_n} D_{\boldp_m}f)_{21} & (D_{\boldp_n} D_{\boldp_m}f)_{22} & (D_{\boldp_n} D_{\boldp_m}f)_{23} \\
(D_{\boldp_n} D_{\boldp_m}f)_{31} & (D_{\boldp_n} D_{\boldp_m}f)_{32} & (D_{\boldp_n} D_{\boldp_m}f)_{33}
\end{pmatrix}
\in \reals^{3\times 3}
\end{align}
with
\begin{equation}
(D_{\boldp_n} D_{\boldp_m}f)_{ij} = \partial_{\boldp_n^{(i)}}\partial_{\boldp_m^{(j)}} f
\end{equation}
for all \(n,m = 1, \dots, N\) and \(i,j = 1, 2, 3\) the /(local) Hessian of f w.r.t. the particles \(\boldp_n\) and \(\boldp_m\)/.
We sometimes use the shorthand notation
\[
H_{nm} = D_{\boldp_n} D_{\boldp_m} (V\circ r) \in \reals^{3\times 3}.
\]


*** Partial derivatives of r
Let \(\boldp \in \reals^3\) and \(\boldq \in \reals^3\) be the coordinates of two particles.
We denote by (\(r = r(\boldp, \boldq)\)) the Euclidean distance between theses particles. The following relations apply:
\begin{align}
(D_{\boldp} r)_i(\boldp, \boldq) &= - \frac{r_i}{r},  \\
(D_{\boldq} r)_j(\boldp, \boldq) &=  \frac{r_j}{r},  \\
(D_{\boldq}D_{\boldp} r)_{ii}(\boldp, \boldq) &= - (D_{\boldp}D_{\boldp} r)_{ii}(\boldp, \boldq) =  \frac{r_i^2}{r^3} - \frac{1}{r},  \\
(D_{\boldq}D_{\boldp} r)_{ij}(\boldp, \boldq) &= - (D_{\boldp}D_{\boldp} r)_{ji}(\boldp, \boldq) =  \frac{r_ir_j}{r^3}, \\
\end{align}

*** Derivatives of the Lennard-Jones potential
We have
\begin{align}
  V'(r) &= \frac{24 \varepsilon}{r} R^6 \left(1 - 2 R^6\right) \\
  V''(r) &= \frac{24 \varepsilon}{r^2} R^6 \left( 26 R^6 - 7 \right).
\end{align}

#+ATTR_LATEX: :width \textwidth
[[file:lennardjones.png]]

*** Lennard-Jones forces and Hessians
We have
\begin{align}
  (D_{\boldp} (V \circ r))_i(\boldp, \boldq) &= - \frac{24 \varepsilon}{r^2} R^6 \left(1 - 2 R^6\right)r_i \\
  (D_{\boldq}D_{\boldp} (V\circ r))_{ii}(\boldp, \boldq) &= - (D_{\boldp}D_{\boldp} (V\circ r))_{ii}(\boldp, \boldq) = \frac{24 \varepsilon}{r^4} R^6 \left(8 - 28 R^6\right)r_i^2 - \frac{24 \varepsilon}{r^2} R^6 \left(1 - 2 R^6\right) \\
  (D_{\boldq}D_{\boldp} (V\circ r))_{ji}(\boldp, \boldq) &= - (D_{\boldp}D_{\boldp} (V\circ r))_{ji}(\boldp, \boldq) = \frac{24 \varepsilon}{r^4} R^6 \left(8 - 28 R^6\right)r_ir_j
\end{align}

** Test description and parameters
In order to test the Hessian computation, simulations with two, three and four particles are conducted.
In most cases stationary particles are placed symmetrically at different distances from each other.
Theses distances occur multiple times in the following and are given by:
| distance | value                        |
|----------+------------------------------|
| \(r_1\)      | 1 \sigma                     |
| \(r_2\)      | 2^{\frac{1}{6}} \sigma       |
| \(r_3\)      | 1.5 \sigma                   |
| \(r_4\)      | 4 \sigma                     |
| \(r_5\)      | 20 \sigma (zero interaction) |
- \(r_1\) corresponds to the first intersection of the Lennard-Jones potential \(V\) with the x-axis.
- \(r_2\) is the minimizer of the Lennard-Jones potential \(V\).
- \(r_3\) is situated near \(r_2\) on the right-hand side of the minimum of \(V\).
- \(r_4\) is situated far away of the minimum and \(V\) does not change much.
- \(r_5\) is situated outside the cell \(r_{\textrm{cut}}\) and thus no interaction should take place at this distance.
*** Test parameters
**** parameters file:
For most of a test a the following parameters-file is used (in all other cases the parameters-file is explicitely given):
#+BEGIN_SRC sh -n
integration: type=dynamics;

lcs: cellrcut=12.0;

domain {
    size: type=cube, size=80.0;
    border: bt_xlow=periodic, bt_xhigh=periodic, bt_ylow=periodic, bt_yhigh=periodic,
        bt_zlow=periodic, bt_zhigh=periodic;
};

dynamics {
    ensemble: ensemble=NVE;
    propagator, verlet: delta_T=5.0e-3, endtime=1.0;
};

optimization {
    particle: state=on, alpha=0.2, beta=0.8, lambda1=0, lambda2=1;

    common: algorithm=cg, maxcg=2001, RT=periodical, maxresetcg=6, LS=strongwolfe,
        maxlinesearch=6, mean_force_eps=1e-6, mean_force_eps_rel=1e-10, prefactor=1e-4;
};

output {
    Outvis: T_Start=0, T_Delta=1.0e-2, Step_Delta=10;
    Outdata: T_Start=0, T_Delta=500, Step_Delta=10;

    Outm: T_Start=0, T_Delta=0.5, Step_Delta=1;

    energy: measure=on;

    analyze {
        velocity: measure=on, meanmeasure=off, vis=off, min=0.0, max=25.0, n_bin=50;
        hessians: measure=on;
    };
};
#+END_SRC
Thus the simulation is done in a cube with side length 80, the cell \(r_{\textrm{cut}}\) is set to 12.
The simulation time is 1.0 such that exactly 100 Hessian measurments are performed.
The <hessians> tag is set in the <analyze> block of the parameters file.
**** potentials file:
For the simulation the only active potential is the Lennard-Jones potential with a cut-off of 12.
The parameters \sigma and \varepsilon are both set to 1.
#+BEGIN_SRC sh -n
particles	{
        particle:	particle_type=Argon,	element_name=Ar,	sigma=1,	epsilon=1,
                        sigma14=1,              epsilon14=1,            mass=1,         free=3,     charge=0;
        };
nonbonded_2body_potentials	{
        lennardjones:	particle_type1=Argon,	particle_type2=Argon,	r_cut=12;
        };
unitsystem: systemofunits=custom;

custom: lengthunit=angstrom;
custom: lengthscalingfactor=3.4;
custom: timeunit=ps;
custom: timescalingfactor=2.17;
custom: massunit=u;
custom: massscalingfactor=39.948;
custom: currentunit="e/s";
custom: currentscalingfactor=1;
custom: temperatureunit=K;
custom: temperaturescalingfactor=120;
#+END_SRC
*** Output
All local Hessians are stored in files =<projectname>.xxxx.hessians=, where xxxx can include the numbers =0000= to =9999=.
In most of the test only for 100 time steps the Hessians are calculated, such that only the files =test.0000.hessians= to =test.0100.hessians= are created.

** Test with deactivated hessians tag
- If the tag <hessians> does not exist in the parameters file, no files =<projectname>.xxxx.hessians= are created and no Hessians are calculated.
- If the tag <hessians> exists but the option =measure=off= is set in the parameters file, no files =<projectname>.xxxx.hessians= are created and no Hessians are calculated. .
- If the tag <hessians> exists in the parameters file and an invalid option is set, then tremolo displays an error message and aborts the simulation.

** Test for two particles
Note that by the formula for the second derivative of the Lennard-Jones potential, the local Hessians for a single particle \(D_{\boldp}D_{\boldp} (V\circ r)\) and for two different particles \(D_{\boldp}D_{\boldq} (V\circ r)\) only differ by a sign.
Thus it is enough to consider only \(D_{\boldp}D_{\boldp} (V\circ r)\).
*** Particles aligned in x-direction, no start velocities
For two particles \(\boldp_1, \boldp_2\) aligned in x-direction one expects:
- diagonal matrices for all local Hessians (since all entries of the form \(r_i r_j\) should vanish if \(i \neq j\))
- the second and third diagonal entry should be equal
**** Summary:
As expected one obtains for all radii diagonal matrices for which the second and third diagonal entries are equal.
For \(r_2\) only the first entry is not equal to zero. The other other two diagonal entries vanish since by the formula for \((D_{\boldq}D_{\boldp} (V\circ r))_{ii}(\boldp, \boldq)\)
the first term in the formula vanishes because of \((\boldq_i - \boldp_i) = 0\)  for \(i = 2, 3\) while the second term equals basically the force between the particles which is zero at \(r_2\) (potential minimum)
For \(r_5\) no entries are calculated since the distance between the particles is larger than \(r_{\textrm{cut}}\).
**** \(r_1\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0    40.0	0.0	0.0	0.0	Argon
2	41.0	40.0	40.0	0.0	0.0	0.0	Argon
#+END_SRC
At all time steps one obtains diagonal matrices as expected.
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1\), diag(456, -24, -24)
- 0050 :: \(r = 1.8156\), diag(-1.275256, 0.191907, 0.191907)
- 0100 :: \(r = 2.16214\), diag(-0.338966, 0.049267, 0.049267)
**** \(r_2\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0          40.0    40.0	0.0	0.0	0.0	Argon
2	41.122462048  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
Since \(r_2\) is the distance of the minimal potential energy the distance between the two particles remains the same during the whole simulation.
As expected one obtains at all times the same matrix which consists of only one single non-zero entry at the (1,1)-position.
The other two diagonal entries dissapear by the formula for \((D_{\boldq}D_{\boldp} (V\circ r))_{ii}(\boldp, \boldq)\): the first term is equal to zero because of \((\boldq_i - \boldp_i) = 0\) for \(i=2, 3\) and
the second term vanishes since it equals the first derivative of the Lennard-Jones potential which is zero at \(r_2\).
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1.122462048\), diag(57.146438, 0, 0)
- 0050 :: \(r = 1.122462048\), diag(57.146438, 0, 0)
- 0100 :: \(r = 1.122462048\), diag(57.146438, 0, 0)
**** \(r_3\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	41.5  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
As for \(r_1\) one obtains at all time steps diagonal matrices.
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r\) = 1.5, diag(-4.41759, 0.772019, 0.772019)
- 0050 :: \(r\) = 1,13286, diag(46.886467, 0.476441, 0.476441)
- 0100 :: \(r\) = 1.45254, diag(-5.125041, 0.953188, 0.953188)
**** \(r_4\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	44.0  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
Same situation as for \(r_3\).
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r\) = 4, diag(-0.002561, 0.000366, 0.000366)
- 0050 :: \(r\) = 3.99926, diag(-0.002565, 0.000367, 0.000367)
- 0100 :: \(r\) = 3.99706, diag(-0.002576, 0.000368, 0.000368)
**** \(r_5\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	60.0  40.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case no interaction between the two particles can happen, since the distance larger than \(r_{\textrm{cut}}\). Thus at all times one gets empty hessians file of the following form:
#+BEGIN_SRC sh -n
# time 0.000000e+00
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
*** Particles aligned in y-direction, no start velocities
For two particles \(\boldp_1, \boldp_2\) aligned in y-direction one expects:
- diagonal matrices for all local Hessians (since all entries of the form \(r_i r_j\) should vanish if \(i \neq j\))
- the first and third diagonal entry should be equal
**** Summary:
One obtains the analogous results as for the case of x-aligned particles.
**** \(r_1\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0    40.0	0.0	0.0	0.0	Argon
2	40.0	41.0	40.0	0.0	0.0	0.0	Argon
#+END_SRC
At all time steps one obtains diagonal matrices as expected.
In the following the of the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1\), diag(-24, 456, -24)
- 0050 :: \(r = 1.8156\), diag(0.191907, -1.275256, 0.191907)
- 0100 :: \(r = 2.16214\), diag(0.049267, -0.338966, 0.049267)
**** \(r_2\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0    40.0          40.0	0.0	0.0	0.0	Argon
2	40.0    41.122462048  40.0	0.0	0.0	0.0	Argon
#+END_SRC
Since \(r_2\) is the distance of the minimal potential energy the distance between the two particles remains the same during the whole simulation.
As expected one obtains at all times the same matrix which consists of only one single non-zero entry at the (2,2)-position.
The other two diagonal entries dissapear since they consists basically of the force between the two particles which vanishes in this case.
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1.122462048\), diag(0, 57.146438, 0)
- 0050 :: \(r = 1.122462048\), diag(0, 57.146438, 0)
- 0100 :: \(r = 1.122462048\), diag(0, 57.146438, 0)
**** \(r_3\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  41.5    40.0	0.0	0.0	0.0	Argon
#+END_SRC
As for \(r_1\) one obtains at all time steps diagonal matrices.
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1.5\), diag(0.772019, -4.41759, 0.772019)
- 0050 :: \(r = 1,13286\), diag(0.476441, 46.886467, 0.476441)
- 0100 :: \(r = 1.45254\), diag(0.953188, -5.125041, 0.953188)
**** \(r_4\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  44.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
Same situation as for \(r_3\).
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 4\), diag(0.000366, -0.002561, 0.000366)
- 0050 :: \(r = 3.99926\), diag(0.000367, -0.002565, 0.000367)
- 0100 :: \(r = 3.99706\), diag(0.000368, -0.002576, 0.000368)
**** \(r_5\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  60.0    40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case no interaction between the two particles can happen, since the distance larger than \(r_{\textrm{cut}}\). Thus at all times one gets empty hessians file of the following form:
#+BEGIN_SRC sh -n
# time 0.000000e+00
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
*** Particles aligned in z-direction, no start velocities
For two particles aligned in z-direction one expects:
- diagonal matrices for all local Hessians (since all entries of the form \(r_i r_j\) should vanish if \(i \neq j\))
- the first and second diagonal entry should be equal
**** Summary:
One obtains the analogous results as for the case of \(x\)-aligned and \(y\)-aligned particles.
**** \(r_1\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0    40.0	0.0	0.0	0.0	Argon
2	40.0	40.0	41.0	0.0	0.0	0.0	Argon
#+END_SRC
At all time steps one obtains diagonal matrices as expected.
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1\), diag(-24, -24, 456)
- 0050 :: \(r = 1.8156\), diag(0.191907, 0.191907,  -1.275256)
- 0100 :: \(r = 2.16214\), diag(0.049267, 0.049267, -0.338966)
**** \(r_2\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0    40.0    40.0           0.0	0.0	0.0	Argon
2	40.0    40.0	41.122462048   0.0	0.0	0.0	Argon
#+END_SRC
Since \(r_2\) is the distance of the minimal potential energy the distance between the two particles remains the same during the whole simulation.
As expected one obtains at all times the same matrix which consists of only one single non-zero entry at the (3,3)-position.
The other two diagonal entries dissapear since they consists basically of the force between the two particles which vanishes in this case.
In the following the absolute values of the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1.122462048\), diag(0, 0, 57.146438)
- 0050 :: \(r = 1.122462048\), diag(0, 0, 57.146438)
- 0100 :: \(r = 1.122462048\), diag(0, 0, 57.146438)
**** \(r_3\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  40.0    41.5	0.0	0.0	0.0	Argon
#+END_SRC
As for \(r_1\) one obtains at all time steps diagonal matrices.
In the following the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 1.5\), diag(0.772019, 0.772019, -4.41759)
- 0050 :: \(r = 1,13286\), diag(0.476441, 0.476441, 46.886467)
- 0100 :: \(r = 1.45254\), diag(0.953188, 0.953188, -5.125041)
**** \(r_4\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  40.0    44.0	0.0	0.0	0.0	Argon
#+END_SRC
Same situation as for \(r_3\).
In the following of the local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given:
- 0000 :: \(r = 4\), diag(0.000366, 0.000366, -0.002561)
- 0050 :: \(r = 3.99926\), diag(0.000367, 0.000367, -0.002565)
- 0100 :: \(r = 3.99706\), diag(0.000368, 0.000368, -0.002576)
**** \(r_5\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0  40.0    40.0	0.0	0.0	0.0	Argon
2	40.0  40.0    60.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case no interaction between the two particles can happen, since the distance larger than \(r_{\textrm{cut}}\). Thus at all times one gets empty hessians file of the following form:
#+BEGIN_SRC sh -n
# time 0.000000e+00
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
*** Particles aligned along a diagonal, pno start velocities
For two (initially stationary) particles \(\boldp_1, \boldp_2\) which are aligned along a space diagonal one can expect:
- all diagonal entries of the local Hessians are equal
- all non-diagonal entries of the local Hessians are equal
**** Summary:
As expected all computed local Hessians have the mentioned symmetric properties, such that all diagonal entries on the one hand and all non-diagonal entries on the other hand are equal.
In contrast to the previous cases no entries are equal to zero which is also quite reasonable, since the difference vector has no zero-entries.
The values of the entries seem to be correct as well.
**** \(r_1\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	40.577350269    40.577350269    40.577350269	0.0	0.0	0.0	Argon
#+END_SRC
The local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) for the first particle at time 0 is given by
\[\begin{pmatrix}
136.000001 & 160.000001 & 160.000001 \\
160.000001 & 136.000001 & 160.000001 \\
160.000001 & 160.000001 & 136.000001
\end{pmatrix}\]
The other three local Hessians differ only in the sign. As expected all diagonal entries are equal as are the non-diagonal ones.
The difference between the diagonal and non-diagonal entries is 24 which is exactly the norm of the force between the particles.
In the following the local Hessians \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given
- 0000 :: \(r = 1\), (136.000001 160.000001 160.000001, 160.000001 136.000001 160.000001, 136.000001 160.000001 136.000001)
- 0050 :: \(r = 1.815587618\), (-0.297147 -0.489054 -0.489054, -0.489054 -0.297147 -0.489054, -0.489054 -0.489054 -0.297147)
- 0100 :: \(r = 2.162136344\), (-0.080144 -0.129411 -0.129411, -0.129411 -0.080144 -0.129411, -0.129411 -0.129411 -0.080144)
**** \(r_2\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	40.648053766    40.648053766    40.648053766	0.0	0.0	0.0	Argon
#+END_SRC
The local Hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) for the first particle at time 0 is given by
\[\begin{pmatrix}
19.048812 & 19.048812 & 19.048812\\
19.048812 & 19.048812 & 19.048812\\
19.048812 & 19.048812 & 19.048812
\end{pmatrix}\]
All entries are equal. Since the force at \(r_2\) vanishes the second summand in the term for the diagonal entries of the
local Hessians dissappears and the remaining term is equal to the formula for the non-diagonal entries of the local Hessians.
In the following the local Hessians \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given
- 0000 :: \(r = 1.122462048\), (19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812)
- 0050 :: \(r = 1.122462048\), (19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812)
- 0100 :: \(r = 1.122462048\), (19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812, 19.048812 19.048812 19.048812)
**** \(r_3\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	40.866025404	40.866025404	40.866025404	0.0	0.0	0.0	Argon
#+END_SRC
The local hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) for the first particle at time 0 is given by
\[\begin{pmatrix}
-0.957852 & -1.729871 & -1.729871\\
-1.729871 & -0.957852 & -1.729871\\
-1.729871 & -1.729871 & -0.957852
\end{pmatrix}\]
The situation is similar as for \(r_1\), i.e. the diagonal entries and the non-diagonal entries each are equal which is quite expected.
In the following the local Hessians \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given
- 0000 :: \(r = 1.5\), (-0.957852 -1.729871 -1.729871, -1.729871 -0.957852 -1.729871, -1.729871 -1.729871 -0.957852)
- 0050 :: \(r = 1.132865151\), (15.946450 15.470009 15.470009, 15.470009 15.946450 15.470009, 15.470009 15.470009 15.946450)
- 0100 :: \(r = 1.452549769\), (-1.072889 -2.026076 -2.026076, -2.026076 -1.072889 -2.026076, -2.026076 -2.026076 -1.072889)
**** \(r_4\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	42.309401077	42.309401077	42.309401077	0.0	0.0	0.0	Argon
#+END_SRC
The local hessian \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) for the first particle at time 0 is given by
\[\begin{pmatrix}
-0.000610 & -0.000976 & -0.000976\\
-0.000976 & -0.000610 & -0.000976\\
-0.000976 & -0.000976 & -0.000610
\end{pmatrix}\]
In this case too, the local Hessians maintain their symmetry properties as in the other cases.
In the following the local Hessians \(D_{\boldp_1} D_{\boldp_1} (V\circ r)\) are given
- 0000 :: \(r = 4\), (-0.000610 -0.000976 -0.000976, -0.000976 -0.000610 -0.000976, -0.000976 -0.000976 -0.000610)
- 0050 :: \(r = 3.999270674\), (-0.000611 -0.000977 -0.000977, -0.000977 -0.000611 -0.000977, -0.000977 -0.000977 -0.000611)
- 0100 :: \(r = 3.997070969\), (-0.000613 -0.000981 -0.000981, -0.000981 -0.000613 -0.000981, -0.000981 -0.000981 -0.000613)
**** \(r_5\):
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0            40.0            40.0            0.0	0.0	0.0	Argon
2	51.547005384	51.547005384	51.547005384	0.0	0.0	0.0	Argon
#+END_SRC
As expected no local Hessians are computed since there is no interaction between the two particles as \(r_5 > r_{\textrm{cut}}\).
Thus all hessians files look like
#+BEGIN_SRC sh -n
# time 5.000000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
#+END_SRC
*** Particle fly-by/swing-by
**** Description:
Two particles are positioned at zero-interaction distance from each other (\(\boldp_1\) at (40.0, 40.0, 40.0) and \(\boldq_1\) at (20.0, 45.0, 40.0)).
The first particle (\(\boldp_1\)) is stationary while the second one has an initial velocity ((40.0, 0.0, 0.0)) such that it passes the
first particle at a certain distance.
The .data file is given by
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0    40.0    40.0    0.0	0.0	0.0	Argon
2	20.0    45.0    40.0   40.0	0.0	0.0	Argon
#+END_SRC
The simulation can be devided into three phases:
- zero-interaction phase :: (\(t = 0\) until \(t = 0.22728\)) During this time the Particles have a distance which is larger than the \(r_{\textrm{cut}}\) = 12.
     No interaction can be expected and therefore empty hessians-files.
- interaction phase :: (\(t = 0.22728\) until \(t = 0.77272\)) During the second phase the Particles are near enought to each other
     and one can expect non-zero Hessians. Since the z-coordinate of both Particles stays equal during the whole simulation
     four of the nine entries of the local Hessians should be zero, namely the entries (1,3), (3,1), (2,3), (3,2).
     Furthermore one can expect that the entries grow until time \(t = 0.5\) and decrease afterwards.
- zero-interaction phase :: (\(t = 0.77272\) until \(t = 1.0\)) For the remaining time the particles have again zero-interaction distance.
     Hence one should obtain empty hessians-files.
**** Test results:
As expected the hessians-files =test.0000.hessians=, ..., =test.0023.hessians= and =test.0078.hessians=, ..., =test.0100.hessians= are empty (zero-interaction).
The remaining files show the expected local Hessians. The absolute values of the local Hessians entries increase towards \(t=0.5\) and decrease afterwards.
E.g. for time \(t = 0.40\) (and up to signs also \(t = 0.60\)):
#+BEGIN_SRC sh -n
# time 4.000000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
1	0	1	0	-0.000018
1	0	1	1	0.000033
1	0	1	2	0.000000
1	1	1	0	0.000033
1	1	1	1	-0.000033
1	1	1	2	-0.000000
1	2	1	0	0.000000
1	2	1	1	-0.000000
1	2	1	2	0.000008
#+END_SRC
One can see that the entries (1,3), (2,3), (3,1) and (3,2) are equal to zero. For \(t = 0.50\) one obtains
#+BEGIN_SRC sh -n
# time 5.000000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
1	0	1	0	0.000061
1	0	1	1	-0.000000
1	0	1	2	-0.000000
1	1	1	0	-0.000000
1	1	1	1	-0.000430
1	1	1	2	-0.000000
1	2	1	0	-0.000000
1	2	1	1	-0.000000
1	2	1	2	0.000061
#+END_SRC
In this case only the diagonal entries are non-zero since the Particles are aligned in \(y\)-direction.
The following plot shows the Frobenius norm of the local Hessian \(H_{11} = (D_{\boldp_1} D_{\boldp_1} V\circ r)\) during the whole simulation.
As one can see the Frobenius norm increases first until \(t = 0.50\) and decreases afterwards.

[[file:2particle_fly_by_frobenius_norm.png]]

*** Particle collision
**** Description:
Two particles are positioned at zero-interaction distance from each other (\(\boldp_1\) at (40.0, 40.0, 40.0) and \(\boldp_2\) at (20.0, 40.0, 40.0)).
The first particle (\(\boldp_1\)) is stationary while the second one has an initial velocity ((40.0, 0.0, 0.0)) such that it will collide
with the first particle at time \(t=0.50\).
The .data file is given by
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0    40.0    40.0    0.0	0.0	0.0	Argon
p2	20.0    40.0    40.0   40.0	0.0	0.0	Argon
#+END_SRC
This simulation can be devided into three phases:
- zero-interaction phase :: (\(t = 0\) until \(t = 0.20\)) During this time the particles have a distance which is larger than the \(r_{\textrm{cut}} = 12\).
     No interaction can be expected and therefore empty hessians-files.
- interaction phase :: (\(t = 0.20\) until \(t = 0.57\)) In this phase the abosolute values of the local Hessian entries increase first with time until the collision at approximately \(t = 0.5\).
     Afterwards they decrease since the second particle bounces back while the other one is accelerated in \(x\)-direction.
     Since in this simulation the particles stay aligned in \(x\)-direction one can expect diagonal matrices for the local Hessians.
- zero-interaction phase :: (\(t = 0.58\) until \(t = 1.0\)()) For the remaining time the particles have again zero-ineteraction distance.
**** Test results:
As expected the files =test.0000.hessians=, ..., =test.0020.hessians= and =test.0057.hessians=, ..., =test.0100.hessians= are empty.
All other files display diagonal matrices. The absolute values of the local Hessians entries increase for increasing \(t\) until \(t = 0.48\) (collision). Afterwards they decrease very rapidely.
For \(t = 0.48\) one gets for the first local Hessian:
#+BEGIN_SRC sh -n
# time 4.800000e-01
# particle_id1   coord1  particle_id2    coord2  hessian_entry
1	0	1	0	13019.502641
1	0	1	1	0.000000
1	0	1	2	0.000000
1	1	1	0	0.000000
1	1	1	1	-935.941320
1	1	1	2	0.000000
1	2	1	0	0.000000
1	2	1	1	0.000000
1	2	1	2	-935.941320
#+END_SRC
The following plot shows the Frobenius norm of the local Hessian \(H_{11} = (D_{\boldp_1} D_{\boldp_1} V\circ r)\) during the whole simulation.
One can see that at \(t = 0.5\) the Frobenius jumps to a value at ca. 13 000. At all other time steps the values of the matrix norm is rather small.
Just before and after the collision the values are between 0.01 and 20 (cannot be seen in the plot because of the large \(y\)-range).

[[file:2particle_collision_frobenius_norm.png]]

** Test for three particles
*** Three particles in an equilateral triangle
**** General description:
Three particles are positioned in such a way that they form an equilateral triangle with side length \(r = r_1, r_2, r_3, r_4\) and \(r_5\).
The first two particles \(\boldp_1\) and \(\boldp_2\) are aligned in \(x\)-direction. The third particle \(\boldp_3\) differs in \(x\)- and \(y\)-direction.
The \(z\)-direction of all particles is equal:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0            40.0		40.0	0.0	0.0	0.0	Argon
2	40.0+r          40.0		40.0	0.0	0.0	0.0	Argon
3	40.0+r/2	40.0+sqrt(3)r/2	40.0	0.0	0.0	0.0	Argon
#+END_SRC

#+ATTR_LATEX: :width 5cm
[[file:equi_triang_r1.png]]

Only the Lennard-Jones potential is activated during the simulation, i.e. the entire potential is given by (using the shorthand notation \(V = V\circ r\)):
\[
V(\boldp_1, \boldp_2, \boldp_3) = V_{12}(\boldp_1, \boldp_2) + V_{13}(\boldp_1, \boldp_3) + V_{23}(\boldp_2, \boldp_3),
\]
where \(V_{ij}\) denotes the pair-potential between the particles \(\boldp_i\) and \(\boldp_j\).
Knowing this, one can deduce the following formulas for the 9 possible local Hessians (using the already mentioned shorthand notation \(H_{nm} = D_{\boldp_n} D_{\boldp_m} (V\circ r) \in \reals^{3\times 3}\)):
- \(H_{11} = (D_{\boldp_1} D_{\boldp_1} V_{12}) + (D_{\boldp_1} D_{\boldp_1} V_{13})\)
- \(H_{22} = (D_{\boldp_2} D_{\boldp_2} V_{12}) + (D_{\boldp_2} D_{\boldp_2} V_{23})\)
- \(H_{33} = (D_{\boldp_3} D_{\boldp_3} V_{13}) + (D_{\boldp_3} D_{\boldp_3} V_{23})\)
- \(H_{12} = (D_{\boldp_1} D_{\boldp_2} V_{12})\)
- \(H_{21} = (D_{\boldp_2} D_{\boldp_1} V_{12})\)
- \(H_{13} = (D_{\boldp_1} D_{\boldp_3} V_{13})\)
- \(H_{31} = (D_{\boldp_3} D_{\boldp_1} V_{13})\)
- \(H_{23} = (D_{\boldp_2} D_{\boldp_3} V_{23})\)
- \(H_{32} = (D_{\boldp_3} D_{\boldp_2} V_{23})\)
Hence, the mixed local Hessians can be expected to be similar to the 2 particles case whereas the "pure" local Hessians are sums of such expressions.
**** General test results:
1. For all choices of \(r\) = \(r_1\), \(r_2\), \(r_3\), \(r_4\) and \(r_5\) every two of the mixed local Hessians are equal: \(H_{12} = H_{21}, H_{13} = H_{31}\) and \(H_{23} = H_{32}\).
   Furthermore as already expected these local Hessians could have been calculated with only two particles, e.g. particle \(\boldp_3\) does not affect the entries of \(H_{12}\).
   Some sample calculation with only two particles at the same positions confirmed this.
   In particular one obtains a diagonal matrix for \(H_{12}\) (\(\boldp_1\) and \(\boldp_2\)) are aligned in \(x\)-direction.
   The matrices \(H_{13}\) and \(H_{23}\) however are not diagonal matrices but have vanishing (1,3), (3,1), (2,3) and (3,2) entries (since the \(z\)-coordinates of all particles are equal).
   One notes that the entries of \(H_{13}\) and \(H_{23}\) differ only by the sign which can be traced to the symmetry.
2. The local Hessians \(H_{11}, H_{22}, H_{33}\) have all vanishing entries at the (1,3), (3,1), (2,3) and (3,2) positions.
   This seems to be reasonable since one can write these Hessians as sums of mixed local Hessians which have only zeros at these positions (already seen in 1.).
   The simulated values of the entries coincide with samples computed manually.
3. The absolute values of all entries of the local Hessians in inversely proportional to the distance between the particles which agrees with the formulas for the Lennard-Jones Hessians.
As an example the local Hessians in the case of \(r = r_1\) are given. All other cases have the same structure but different numeric values.
- H_{11} :: [552, 207.85, 0]
            [207.85, 312, 0]
            [0, 0, -48]
- H_{22} :: [552, -207.85, 0]
            [-207.85, 312, 0]
            [0, 0, -48]
- H_{33} :: [192, 0, 0]
            [0, 672, 0]
            [0, 0, -48]
- H_{12} = H_{21} :: [-456, 0, 0]
     [0, 24, 0]
     [0, 0, 24]
- H_{13} = H_{31} :: [-96, -207.85, 0]
     [-207.85, -336, 0]
     [0, 0, 24]
- H_{23} = H_{32} :: [-96, 207.85, 0]
     [207.85, -336, 0]
     [0, 0, 24]
**** Eigenvalues of the Hessians:
As a further check the eigenvalues of the local Hessians are computed. For the above simulation one expects that the three eigenvalues of the "pure" Hessians (\(H_{ii}\)) are always the same because of the symmetry. The same should apply for the mixed Hessians (\(H_{ij}\)).
In the following the eigenvalues of the computed Hessians at \(t = 0\) for \(r_1, r_2\) and \(r_3\) are given:
One can see that the eigenvalues of the matrices do indeed coincide in the described manner.
***** \(r_1\)
- H_11 :: \lambda = (672, 192, -48)
- H_22 :: \lambda = (672, 192, -48)
- H_33 :: \lambda = (672, 192, -48)
- H_12 :: \lambda = (24, 24, -456)
- H_13 :: \lambda = (24, 24, -456)
- H_23 :: \lambda = (24, 24, -456)
***** \(r_2\)
- H_11 :: \lambda = (85.719656, 28.573219, 0.0)
- H_22 :: \lambda = (85.719656, 28.573219, 0.0)
- H_33 :: \lambda = (85.719656, 28.573219, 0.0)
- H_12 :: \lambda = (-57.146437, 0.0, 0.0)
- H_13 :: \lambda = (-57.146438, 0.0, 0.0)
- H_23 :: \lambda = (-57.146437, 0.0, 0.0)
***** \(r_3\)
- H_11 :: \lambda = (-6.240382, -1.050768, 1.544038)
- H_22 :: \lambda = (-6.240382, -1.050768, 1.544038)
- H_33 :: \lambda = (-6.240382, -1.050768, 1.544038)
- H_12 :: \lambda = (4.417594, -0.772019, -0.772019)
- H_13 :: \lambda = (4.417594, -0.772019, -0.772019)
- H_23 :: \lambda = (4.417594, -0.772019, -0.772019)
***** \(r_4\)
- H_11 :: \lambda = (-0.00369149, -0.00074151, 0.000732)
- H_22 :: \lambda = (-0.00369149, -0.00074151, 0.000732)
- H_33 :: \lambda = (-0.00369149, -0.00074151, 0.000732)
- H_12 :: \lambda = (0.002561, -0.000366, -0.000366)
- H_13 :: \lambda = (0.002561, -0.000366, -0.000366)
- H_23 :: \lambda = (0.002561, -0.000366, -0.000366)
**** \(r_1\)
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	41.0	40.0		40.0	0.0	0.0	0.0	Argon
3	40.5	40.866025404	40.0	0.0	0.0	0.0	Argon
#+END_SRC
**** \(r_2\)
the data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0		40.0		40.0	0.0	0.0	0.0	Argon
2	41.122462048	40.0		40.0	0.0	0.0	0.0	Argon
3	40.561231024	40.972080649	40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case all particles stay stationary over the whole simulation. The local Hessians are (at least for 6 decimal positions) constant.
**** \(r_3\)
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	41.5	40.0		40.0	0.0	0.0	0.0	Argon
3	40.75	41.299038106	40.0	0.0	0.0	0.0	Argon
#+END_SRC
**** \(r_4\)
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	44.0	40.0		40.0	0.0	0.0	0.0	Argon
3	42.0	43.464101615	40.0	0.0	0.0	0.0	Argon
#+END_SRC
**** \(r_5\)
the data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0	0.0	0.0	0.0	Argon
2	60.0	40.0		40.0	0.0	0.0	0.0	Argon
3	50.0	57.320508076	40.0	0.0	0.0	0.0	Argon
#+END_SRC
In this case (\(r > r_{\textrm{cut}}\)) all hessians-files are empty for the whole simulation.
*** Particle collision
**** Test parameters:
For this collision test slightly different test parameters are chosen.
- \sigma = \varepsilon = 1
- cell \(r_{\textrm{cut}}\) = 10
- edge length of the simulation cube: 100
- =delta_T= = 5.0e-3
- =endtime= = 3.0
- =outvis T_Delta= = 1.0e-2
The only active potential is the Lennard-Jones potential.
The parameter file is given by:
#+BEGIN_SRC sh -n
integration: type=dynamics;

domain {
    size: type=cube, size=100.0;
    border: bt_xlow=periodic, bt_xhigh=periodic, bt_ylow=periodic, bt_yhigh=periodic,
        bt_zlow=periodic, bt_zhigh=periodic;
};

dynamics {
    ensemble: ensemble=NVE;
    propagator, verlet: delta_T=5.0e-3, endtime=3.0;
};

optimization {
    particle: state=on, alpha=0.2, beta=0.8, lambda1=0, lambda2=1;

    common: algorithm=cg, maxcg=2001, RT=periodical, maxresetcg=6, LS=strongwolfe,
        maxlinesearch=6, mean_force_eps=1e-6, mean_force_eps_rel=1e-10, prefactor=1e-4;
};

output {
    Outvis: T_Start=0, T_Delta=1.0e-2, Step_Delta=10;
    Outdata: T_Start=0, T_Delta=500, Step_Delta=10;

    Outm: T_Start=0, T_Delta=0.5, Step_Delta=1;

    energy: measure=on;

    analyze {
        velocity: measure=on, meanmeasure=off, vis=off, min=0.0, max=25.0, n_bin=50;
        hessians: measure=on;
    };
};
#+END_SRC
**** Test description:
- All 3 identical particles \(\boldp_1, \boldp_2, \boldp_3\) share the same \(z\)-plane. Two of the particles (\(\boldp_1\) and \(\boldp_2\)) are situated stationary
  at a distance of ca. 28.28 aligned along the (\(x,y\))-diagonal (\(\boldp_1 = (50.75, 55, 55), \boldp_2 = (70.75, 75, 55)\)).
  Note that, \(\boldp_1\) is placed near the linked-cell face at \(x = 50\) such that it can be checked the Hessians are calculated correctly across linked-cells.
  The third particle \(\boldp_3\) is also aligned along this axis. Its initial position is about 42.43 away from \(\boldp_1\)  and 70.71 from \(\boldp_2\).
  The third particle has an initial velocity of \(v = (20, 20, 0)\).
  Note that at the beginning all distances between the particles are larger than the given \(r_{\textrm{cut}}\), so no interaction occurs in the initial state.
  The data file is given by:
  #+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	50.75	55.0	55.0	0.0	0.0	0.0	Argon
2	70.75	75.0	55.0	0.0	0.0	0.0	Argon
3	20.75	25.0	55.0	20.0	20.0	0.0	Argon
  #+END_SRC
- During the simulation \(\boldp_3\) collides first with \(\boldp_1\) and is decelerated and \(\boldp_1\) is accelarated.
  Therefore \(\boldp_3\) nearly stops moving whereas \(\boldp_1\) collides with \(\boldp_2\) resulting in a similar collision as before.
  Because of the chosen distances between the particles only two of the three particles interact at any given time step.
#+ATTR_LATEX: :width 5cm
[[file:collision_1.png]]
#+ATTR_LATEX: :width 5cm
[[file:collision_2.png]]
#+ATTR_LATEX: :width 5cm
[[file:collision_3.png]]
**** Test results:
1. General results:
   - all local Hessians are symmetric as expected
   - For all local Hessians the (1,3), (3,1), (2,3) and (3,2) entries are zero, which is a consequence of the fact that all particles share the same \(z\)-coordinate
   - The values of local Hessians change according to the distances between the particles (see below).
     As expected only local Hessians of particles which have distances below 10.0 are displayed in the hessians-files.
2. The simulation can be partitioned in 7 phases:
   1. \(t=0\) to \(t=1.145\) (files =0000= to =0114=):
      - distances between \(\boldp_1\) and \(\boldp_3\): \(r_0=42.43\) to \(r_{1.145}=10.041\)
      - no interaction between the particles
   2. \(t=1.155\) to \(t=1.475\) (files =0115= to =0147=):
      - decreasing distances between \(\boldp_1\) and \(\boldp_3\): \(r_{1.155}=9.76\) to \(r_{1.475}=0.72\)
      - only interactions between \(\boldp_1\) and \(\boldp_3\)
   3. \(t=1.485\) to \(t=1.825\) (files =0148= to =0182=):
      - increasing distances between \(\boldp_1\) and \(\boldp_3\): \(r_{1.485}=0.87\) to \(r_{1.825}=9.86\)
      - only interactions between \(\boldp_1\) and \(\boldp_3\)
   4. \(t=1.835\) to \(t=2.135\) (files =0183= to =0213=):
      - distance between \(\boldp_1\) and \(\boldp_2\) decreases to \(r_{2.135}=10.27\)
      - no interaction between the particles
   5. \(t=2.145\) to \(t=2.485\) (files =0214= to =0248=):
      - decreasing distances between \(\boldp_1\) and \(\boldp_2\): \(r_{2.145}=9.997\) to \(r_{2.485}=0.72\)
      - only interactions between \(\boldp_1\) and \(\boldp_2\)
   6. \(t=2.495\) to \(t=2.855\) (files =0249= to =0285=):
      - increasing distances between \(\boldp_1\) and \(\boldp_2\): \(r_{2.495}=0.89\) to \(r_{2.855}=9.94\)
      - only interactions between \(\boldp_1\) and \(\boldp_2\)
   7. \(t=2.865\) to \(t=3.000\) (files =0286= to =0300=):
      - increasing distances between \(\boldp_1\) and \(\boldp_2\): \(r_{2.865}=10.19\) to \(r_{3.000}=13.71\)()
      - no interaction between the particles
3. For these 7 phases the following results concerning the local Hessians were archieved:
   1. In phase 1 all corresponding hessians-files were empty. This is the desired behaviour since all distances are larger than the \(r_{\textrm{cut}}\).
   2. In phase 2 the corresponding hessians-files display values for \(H_{11}, H_{33}, H_{13}\) and H\(_{31}\).
      The values of the (\(H_{11})_{1,1}\) decrease first very slowly from -0.000001 to -1.508 and then increase fast to 25165.93.
      This follows the graph of the second derivative of the Lennard-Jones potential.
   3. In phase 3 again all corresponding hessians-files display ony values for \(H_{11}, H_{33}, H_{13}\) and \(H_{31}\).
      The numerical values evolve backwards in comparison to phase 2.
   4. In pahse 4 all corresponding hessians-files are again empty.
   5. The phases 5, 6, 7 are similar to the phases 2, 3, 4, respectively, with slightly different values in the entries.
      A comparison of the values of (\(H_{11})_{1,1}\) during the first collision with the values of (\(H_{22})_{1,1}\) during the second
      collision show an almost identical behaviour (see first plot).
      The same is true if one compares the (1,2) entry of \(H_{31}\) during the first collision and \(H_{12}\) during the second collision (see second plot).
#+ATTR_LATEX: :width 7cm
[[file:comparison.png]]
[[file:comparison2.png]]


**** Similar test with different epsilon values:
A similar test with a different epsilon value (4 instead of 1) for \(\boldp_1\) gives similar results with slightly different numerical values.
** Test for four particles
*** Four particles in an tetrahedron
**** General description:
Four identical particles are positioned in such a way that they form an tetrahedron with side lengths \(r\) = \(r_1\), \(r_2\), \(r_3\), \(r_4\) and \(r_5\), respectively.
The first three particles \(\boldp_1\), \(\boldp_2\) and \(\boldp_3\) form the equilateral triangle described in the section about three particles in an equilateral triangle.
The last particle has a different \(z\)-coordinate with respect to the other particles:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
1    40.0       40.0                40.0           0.0    0.0    0.0	Argon
2    40.0+r     40.0                40.0           0.0    0.0    0.0	Argon
3    40.0+r/2	40.0+sqrt(3)r/2     40.0           0.0    0.0    0.0	Argon
4    40.0+r/2   40.0+r/(2*sqrt(3))  40+sqrt(2/3)r  0.0    0.0    0.0    Argon
#+END_SRC
#+ATTR_LATEX: :width 5cm
[[file:tetrahedron_r1.png]]
**** Observations:
As the only active potential during the simulation is the Lennard-Jones potential the system potential is given by (using \(V = V\circ r\))
\[
V(\boldp_1, \boldp_2, \boldp_3, \boldp_4) = V_{12}(\boldp_1, \boldp_2) + V_{13}(\boldp_1, \boldp_2) + V_{23}(\boldp_2, \boldp_3) + V_{24}(\boldp_2, \boldp_4) + V_{34}(\boldp_3, \boldp_4).
\]
Hence the (local) Hessians are given by
\[
H_{ii} = \sum_{j=1}^4 (D_{\boldp_i} D_{\boldp_i} V_{ij}) \quad \text{for all } i = 1, ..., 4,
\]
and
\[
H_{ij} = (D_{\boldp_i} D_{\boldp_j} V_{ij}) \quad \text{for all } i, j = 1, ..., 4.
\]
From this we can deduce the following expectations:
1. The mixed Hessians \(H_{ij}\) do only depend on the two particles \(p_i\) and \(p_j\). In particular this means that the Hessians \(H_{12}\), \(H_{13}\) and \(H_{23}\) must have the exact same form as for the 3 particle case (equilateral triangle, see above).
2. All mixed Hessians with the same indices must be identical: \(H_{ij} = H_{ji}\).
3. With increasing distance the absolute values of the Hessian entries should decrease.
4. All Hessians should share the same eigenvalues (for mixed/pure Hessians separately).
We will see in the following that these expectations are indeed fullfilled in the simulations.
**** Overview of the test results:
For all radii \(r_1\), ..., \(r_5\) the following test results could be found:
1. The absolute values of the local Hessian's entries are large for small distances \(r < 1.2\) and very small for large distances \(r > 2\). For \(1.2 < r < 2\) the entries are of magnitude 5-10.
   For \(r \to 1\) the absolute values of the Hessian's entries increase very fast wheras for \(r \to \inf\) the decay is rather slowly. In between, for \(r\) going from 1.2 to 2, the absolute values first decay, then increase towards \(r = 1.4\) and decrease again.
   This coincides with the graph of the second derivative of the Lennard-Jones potential.
2. All local Hessians are symmetric and one has the relation \(H_{ij} = H_{ji}\) for all mixed local Hessians.
3. The local Hessians \(H_{12}, H_{13}\) and \(H_{23}\) are equal to the ones found in the 3 particles case positioned in the an equilateral triangle (see above).
4. The 'pure' Hessians \(H_{11}, H_{22}\) do not have any zero-entries wheras \(H_{33}\) has zeros at the (1,2), (1,3), (2,1) and (3,1) entries and \(H_{44}\) is diagonal. In addition \(H_{11}\) and \(H_{22}\) differ only in the signs of some of the entries.
   This behaviour is caused by the symmetry (\(\boldp_1\), \(\boldp_2\) aligned in \(x\)-direction, \(\boldp_1\), \(\boldp_2\), \(\boldp_3\) aligned in the same \(z\)-plane).
5. For each time step, the eigenvalues of all 'pure' Hessians are equal. The same applies to all mixed local Hessians.
**** Test results for \(r_1\):
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0		0.0	0.0	0.0	Argon
2	41.0	40.0		40.0		0.0	0.0	0.0	Argon
3	40.5	40.866025404	40.0		0.0	0.0	0.0	Argon
4	40.5	40.288675135	40.816496581	0.0	0.0	0.0	Argon
#+END_SRC
Specific results:
1. Absolute values of the entries in the local Hessians are large at the beginning but decrease very fast (from ca. 100 at t=0 to ca 5 at t=0.1) going slowly down to zero.
   As an example the values of H_{11} for t = 0, t = 0.5 and t = 1.0 are given (row-wise):
   - 0000 :: \(r\) = 1.0, H_{11} = (647.999999 277.128128 195.959179; 277.128128 327.999999 113.137085; 195.959179 113.137085 247.999999)
   - 0050 :: \(r\) = 1.97816, H_{11} = (-0.859692 -0.445139 -0.314761; -0.445139 -0.345690 -0.181727; -0.314761 -0.181727 -0.217189)
   - 0100 :: \(r\) = 2.34264, H_{11} = (-0.232366 -0.119620 -0.084584; -0.119620 -0.094241 -0.048835; -0.084584 -0.048835 -0.059709)
2. For t=0 the eigenvalues of the local Hessians are given by
   - H_{11} :: \lambda = (888, 168, 168)
   - H_{22} :: \lambda = (888, 168, 168)
   - H_{33} :: \lambda = (888, 168, 168)
   - H_{44} :: \lambda = (888, 168, 168)
   - H_{12} :: \lambda = (24, 24, -456)
   - H_{13} :: \lambda = (24, 24, -456)
   - H_{14} :: \lambda = (24, 24, -456)
   - H_{23} :: \lambda = (24, 24, -456)
   - H_{24} :: \lambda = (24, 24, -456)
   - H_{34} :: \lambda = (24, 24, -456)
**** Test results for \(r_2\):
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0		40.0		40.0		0.0	0.0	0.0	Argon
2	41.122462048	40.0		40.0		0.0	0.0	0.0	Argon
3	40.561231024	40.972080649	40.0		0.0	0.0	0.0	Argon
4	40.561231024	40.324026883    40.916486425	0.0	0.0	0.0	Argon
#+END_SRC
Specific tests results:
1. During the whole simulation the local Hessians stay the same (apart from very small changes in the last decimal place).
   As an example the values of H_{11} for t = 0, t = 0.5 and t = 1.0 are given (row-wise):
   - 0000 :: \(r\) = 1.22462048, H_{11} = (85.719657 32.993511 23.329935; 32.993511 47.622031 13.469545; 23.329935 13.469545 38.097625)
   - 0050 :: \(r\) = 1.22462048, H_{11} = (85.719657 32.993511 23.329936; 32.993511 47.622032 13.469545; 23.329936 13.469545 38.097625)
   - 0100 :: \(r\) = 1.22462048, H_{11} = (85.719657 32.993511 23.329936; 32.993511 47.622032 13.469545; 23.329936 13.469545 38.097625)
**** Test results for \(r_3\) :
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0		0.0	0.0	0.0	Argon
2	41.5	40.0		40.0		0.0	0.0	0.0	Argon
3	40.75	41.299038106	40.0		0.0	0.0	0.0	Argon
4       40.75	40.433012702	41.224744871    0.0	0.0	0.0	Argon
#+END_SRC
Specific test results:
1. During the simulation the absolute values of the local Hessians decrease and increase several times. This is due to the periodic motion of the particles:
   - t=0 -- t=0.16: values decrease slowly (values from (H_{11})_{1,1}: -5.4 -- -6.9)
   - t=0.16 -- t=0.3: values increase fast (-6.9 -- 499)
   - t=0.3 -- t=0.46: values decrease fast (499 -- -6.9)
   - t=0.46 -- t=0.62: values increase slowly (-6.9 -- -5.4)
   - t=0.62 -- t=0.76: values decrease slowly (-5.4 -- -6.9)
   - t=0.76 -- t=0.92: values increase fast (-6.0 -- 507)
   - t=0.92 -- t=1.00: values decrease fast (507 -- 1.4)
   As an example the values of H_{11} for t = 0, t = 0.5 and t = 1.0 are given (row-wise):
   - 0000 :: \(r\) = 1.5, H_{11} = (-5.468362 -2.996225 -2.118651; -2.996225 -2.008620 -1.223204; -2.118651 -1.223204 -1.143685)
   - 0050 :: \(r\) = 1.44476, H_{11} = (-6.374040 -3.592231 -2.540091; -3.592231 -2.226089 -1.466522; -2.540091 -1.466522 -1.189101)
   - 0100 :: \(r\) = 1.25166, H_{11} = (1.442896 -1.652185 -1.168270; -1.652185 3.350673 -0.674501; -1.168270 -0.674501 3.827620)
**** Test results for \(r_4\):
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0		0.0	0.0	0.0	Argon
2	44.0	40.0		40.0		0.0	0.0	0.0	Argon
3	42.0	43.464101615	40.0		0.0	0.0	0.0	Argon
4	42.0	41.154700538    43.265986324	0.0	0.0	0.0	Argon
#+END_SRC
Specific test results:
1. During the whole simulation the absolute values of the local Hessian's entries are rather small and increase very slowly.
   This is due to the relative large distance between the particles which results in a very slow motion during the simulation time.
   As an example the values of H_{11} for t = 0, t = 0.5 and t = 1.0 are given (row-wise):
   - 0000 :: \(r\) = 4, H_{11} = (-0.003293 -0.001690 -0.001195; -0.001690 -0.001341 -0.000690; -0.001195 -0.000690 -0.000853)
   - 0050 :: \(r\) = 3.99854, H_{11} = (-0.003302 -0.001695 -0.001199; -0.001695 -0.001345 -0.000692; -0.001199 -0.000692 -0.000856)
   - 0100 :: \(r\) = 3.99414, H_{11} = (-0.003332 -0.001710 -0.001209; -0.001710 -0.001357 -0.000698; -0.001209 -0.000698 -0.000863)
**** Test results for \(r_5\):
The data file is given by:
#+BEGIN_SRC sh -n
# ATOMDATA Id x=3 u=3 type
# INPUTCONV moment 0
1	40.0	40.0		40.0		0.0	0.0	0.0	Argon
2	60.0	40.0		40.0		0.0	0.0	0.0	Argon
3	50.0	57.320508076	40.0		0.0	0.0	0.0	Argon
4	50.0	45.773502692    56.329931619	0.0	0.0	0.0	Argon
#+END_SRC
Specific test results:
1. All hessians-files are empty. This is expected since the distance between the particles is larger than the \(r_{\textrm{cut}}\) distance, which results in zero interaction.
   Example of hessian file:
   #+BEGIN_SRC sh -n
# time 0.000000e+00
# particle_id1   coord1  particle_id2    coord2  hessian_entry
   #+END_SRC
